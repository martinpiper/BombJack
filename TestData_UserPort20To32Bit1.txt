; Signals from the user port
._PC = $00010000	; Low is write
.SP1 = $01000000
.SP2 = $02000000
.SERIALATN = $04000000
.PA2 = $08000000
.latch0 = $00000000
.latch1 = $01000000
.latch2 = $02000000
.latch3 = $03000000
.latch4 = $04000000
.latch5 = $05000000
.latch6 = $06000000
.latch7 = $07000000
.latch8 = $08000000
.latch9 = $09000000
.latch10 = $0a000000
.latch11 = $0b000000
.latch12 = $0c000000
.latch13 = $0d000000
.latch14 = $0e000000
.latch15 = $0f000000

; Set to input from the C64
.DDR = $00000100


; Latch7 bits
; $00	Pass-through (default on reset)
; $01	Choose RAM
; $02	Pass-through disable
; $03	Disabled, low data, high PA2 high _PC
; $04	Internal PA2
.latch7_Passthrough=$00
.latch7_RAM=$01
.latch7_PassthroughDisable=$02
.latch7_Disabled=$03
.latch7_InternalPA2=$04


; Used for debugging
.BreakPoint = $80000000


; During power-on reset
d=latch0 | _PC | $00
d=latch0 | _PC | $01
d=latch0 | _PC | $02
d=latch0 | _PC | $03
d=latch0 | _PC | $04

; After power-on reset
; Default is pass-through mode, these inputs should be seen at the output, as long as latch7 isn't altered
d=latch8 | _PC | $00
d=latch8 | _PC | $01
d=latch0 | _PC | $02
d=latch0 | _PC | $03

d=latch8 | _PC | $00
d=latch8 | _PC | $01
d=latch8 | $01
d=latch8 | _PC | $01

d=latch8 | _PC | $01
d=latch8 | _PC | $02
d=latch8 | $02
d=latch8 | _PC | $02

d=latch8 | _PC | $02
d=latch8 | _PC | $03
d=latch8 | $03
d=latch8 | _PC | $03

; Set latch7 - Disabled mode, ($03)
d=latch7 | _PC | latch7_Disabled
d=latch7 | latch7_Disabled
d=latch7 | _PC | latch7_Disabled

; Set adders
d=latch8 | _PC | $18
d=latch8 | $18
d=latch8 | _PC | $18
d=latch9 | _PC | $01
d=latch9 | $01
d=latch9 | _PC | $01
d=latch10 | _PC | $00
d=latch10 | $00
d=latch10 | _PC | $00


; Set latch0
d=latch0 | _PC | $04
d=latch0 | $37
d=latch0 | _PC | $37

; Set latch1
d=latch1 | _PC | $37
d=latch1 | $01
d=latch1 | _PC | $01

; Set latch6 (Write RAM)
d=latch6 | _PC | $00
; Write $23
d=latch6 | $23
d=latch6 | _PC | $23
; Write $34
d=latch6 | $34
d=latch6 | _PC | $34
; Write $17
d=latch6 | $17
d=latch6 | _PC | $17
; Write $98
d=latch6 | $98
d=latch6 | _PC | $98


; Reset address...
d=latch0 | _PC | $04
; Set latch0 = $37
d=latch0 | $37
d=latch0 | _PC | $37

; Set latch1
d=latch1 | _PC | $37
; Set latch0 = $01
d=latch1 | $01
d=latch1 | _PC | $01

; Simulate C64 side setting user port DDR
d=latch1 | _PC | $01 | DDR

; Set latch5
d=latch5 | _PC | $01 | DDR
; "Write" latch5 (Read RAM)
d=latch5 | $00 | DDR
d=latch5 | _PC | $00 | DDR

d=latch5 | $00 | DDR
d=latch5 | _PC | $00 | DDR

d=latch5 | $00 | DDR
d=latch5 | _PC | $00 | DDR

d=latch5 | $00 | DDR
d=latch5 | _PC | $00 | DDR


; Write to latch3 which should read the added address...
d=latch3 | _PC | $00
d=latch3 | $00
d=latch3 | _PC | $00


; Set latch6 (Write RAM) continuing with the last read address
d=latch6 | _PC | $00
; Write $11
d=latch6 | $11
d=latch6 | _PC | $11
; Write $22
d=latch6 | $22
d=latch6 | _PC | $22
; Write $33
d=latch6 | $33
d=latch6 | _PC | $33
; Write $44
d=latch6 | $44
d=latch6 | _PC | $44


; Reset address...
d=latch0 | _PC | $04
; Set latch0 = $37
d=latch0 | $37
d=latch0 | _PC | $37

; Set latch1
d=latch1 | _PC | $37
; Set latch0 = $01
d=latch1 | $01
d=latch1 | _PC | $01

; Set latch7 - Enable pass-through
; When altering the pass-through operation via latch7, do not track its _PC signal.

d=latch7 | _PC | latch7_Passthrough
d=latch7 | latch7_Passthrough
d=latch7 | _PC | latch7_Passthrough

; PA2 toggle twice
; Note: Latch7 controls internal PA2
d=latch7 | latch7_PassthroughDisable | latch7_InternalPA2
d=latch7 | _PC | latch7_PassthroughDisable | latch7_InternalPA2
d=latch7 | latch7_PassthroughDisable
d=latch7 | _PC | latch7_PassthroughDisable
d=latch7 | latch7_PassthroughDisable | latch7_InternalPA2
d=latch7 | _PC | latch7_PassthroughDisable | latch7_InternalPA2
d=latch7 | latch7_PassthroughDisable
d=latch7 | _PC | latch7_PassthroughDisable

; Break
;d=BreakPoint

; Write some direct bytes to the pass-through with latch4, only when using "$02	Pass-through disable"
d=latch4 | _PC | $11
d=latch4 | $11
d=latch4 | _PC | $22
d=latch4 | $22
d=latch4 | _PC | $33
d=latch4 | $33
d=latch4 | _PC | $44
d=latch4 | $44


; Set latch7 - Enable RAM to pass-through
d=latch7 | _PC | latch7_RAM
d=latch7 | latch7_RAM
d=latch7 | _PC | latch7_RAM


; Simulate C64 side setting user port DDR
d=latch7 | _PC | latch7_RAM	| DDR

; Set latch5
d=latch5 | _PC | $01	| DDR
; "Write" latch5 (Read RAM)
d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

; Read from latch3 which should read the added address...
d=latch3 | _PC | $00	| DDR
d=latch3 | $00	| DDR
d=latch3 | _PC | $00	| DDR

d=latch5 | _PC | $00	| DDR
d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR

d=latch5 | $00	| DDR
d=latch5 | _PC | $00	| DDR
