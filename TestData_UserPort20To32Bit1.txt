; Signals from the user port
._PC = $00010000	; Low is write
.SP1 = $01000000
.SP2 = $02000000
.SERIALATN = $04000000
.PA2 = $08000000
.latch0 = $00000000
.latch1 = $01000000
.latch2 = $02000000
.latch3 = $03000000
.latch4 = $04000000
.latch5 = $05000000
.latch6 = $06000000
.latch7 = $07000000
.latch8 = $08000000
.latch9 = $09000000
.latch10 = $0a000000
.latch11 = $0b000000
.latch12 = $0c000000
.latch13 = $0d000000
.latch14 = $0e000000
.latch15 = $0f000000

; Set to input from the C64
.DDR = $00000100

; Used for debugging
.BreakPoint = $80000000


; During power-on reset
d=_PC | $00
d=_PC | $01
d=_PC | $02
d=_PC | $03
d=_PC | $04

; After power-on reset
; Default is pass-through mode, these inputs should be seen at the output, as long as latch7 isn't altered
d=latch8 | _PC | $00
d=latch8 | _PC | $01
d=_PC | $02
d=_PC | $03

d=latch8 | _PC | $00
d=latch8 | _PC | $01
d=latch8 | $01
d=latch8 | _PC | $01

d=latch8 | _PC | $01
d=latch8 | _PC | $02
d=latch8 | $02
d=latch8 | _PC | $02

d=latch8 | _PC | $02
d=latch8 | _PC | $03
d=latch8 | $03
d=latch8 | _PC | $03

; Set latch7 - Disabled mode, ($03)
d=latch7 | _PC | $03
d=latch7 | $03
d=latch7 | _PC | $03

; Set adders
d$08010018
d$08000018
d$08010018
d$09010001
d$09000001
d$09010001
d$0a010000
d$0a000000
d$0a010000


; Set latch0
d$00010004
d$00000037
d$00010037

; Set latch1
d$01010037
d$01000001
d$01010001

; Set latch6 (Write RAM)
d$06010000
; Write $23
d$06000023
d$06010023
; Write $34
d$06000034
d$06010034
; Write $17
d$06000017
d$06010017
; Write $98
d$06000098
d$06010098


; Reset address...
d$00010004
; Set latch0 = $37
d$00000037
d$00010037

; Set latch1
d$01010037
; Set latch0 = $01
d$01000001
d$01010001

; Simulate C64 side setting user port DDR
d$01010101

; Set latch5
d$05010101
; "Write" latch5 (Read RAM)
d$05000100
d$05010100

d$05000100
d$05010100

d$05000100
d$05010100

d$05000100
d$05010100


; Write to latch3 which should read the added address...
d$03010000
d$03000000
d$03010000


; Set latch6 (Write RAM) continuing with the last read address
d$06010000
; Write $11
d$06000011
d$06010011
; Write $22
d$06000022
d$06010022
; Write $33
d$06000033
d$06010033
; Write $44
d$06000044
d$06010044


; Reset address...
d$00010004
; Set latch0 = $37
d$00000037
d$00010037

; Set latch1
d$01010037
; Set latch0 = $01
d$01000001
d$01010001

; Set latch7 - Enable pass-through
; When altering the pass-through operation via latch 7, do not track its _PC signal.

d$07010000
d$07000000
d$07010000

; Latch 7 bits
; $01	Choose RAM
; $02	Pass-through disable
; $03	Disabled, low data, high PA2 high _PC
; $04	Internal PA2


; PA2 toggle twice
; Note: Latch7 controls internal PA2
d$07000006
d$07010006
d$07000002
d$07010002
d$07000006
d$07010006
d$07000002
d$07010002

; Break
;d$80000000

; Write some direct bytes to the pass-through with latch4, only when using "$02	Pass-through disable"
d$04010011
d$04000011
d$04010022
d$04000022
d$04010033
d$04000033
d$04010044
d$04000044


; Set latch7 - Enable RAM to pass-through
d$07010001
d$07000001
d$07010001


; Simulate C64 side setting user port DDR
d=$07010001	DDR

; Set latch5
d=$05010001	DDR
; "Write" latch5 (Read RAM)
d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR

; Read from latch3 which should read the added address...
d=$03010000	DDR
d=$03000000	DDR
d=$03010000	DDR

d=$05010000	DDR
d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR

d=$05000000	DDR
d=$05010000	DDR
